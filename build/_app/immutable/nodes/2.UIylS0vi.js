import{s as xe,n as ce,r as ke}from"../chunks/scheduler.BvLojk_z.js";import{S as _e,i as Be,e as _,s as W,c as B,y as U,h as q,d as F,g as M,o as P,z as A,p as de,j as H,k as E,A as J,B as Te,H as Me,m as fe,b as Ae,C as Se,f as Le,l as Pe}from"../chunks/index.CV2bLQqF.js";function he(e){return(e==null?void 0:e.length)!==void 0?e:Array.from(e)}function Ne(e){let t=[...e.toLowerCase().matchAll(/[a-z]+/g)],n=t.map(s=>s[0]).join(" "),r=[];t.forEach(s=>{for(let c=s.index;c<s.index+s[0].length;c++)r.push(c);r.push(void 0)});let a=[],o=0;return t.forEach(s=>{let c=s.index,l=s.index+s[0].length,i=s[0],d="";c>o&&(d=e.slice(o,c));let p=e.slice(c,l);o=l,a.push({start:c,end:l,pre:d,text:p,word:i})}),o<e.length&&a.push({start:o,end:e.length,pre:e.slice(o),text:"",word:""}),{origText:n,origLocs:r,dispSegs:a}}function ye(e,t,{maxlen:n=10,minlen:r=2,step:a=1}){r>=e.length&&(r=e.length-1);let o=[];for(let s=n;s>=r;s--){let c=[];for(let l=0;l<=e.length-s;l+=a)c.push(e.slice(l,l+s));c.forEach((l,i)=>{let d=l.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");Array.from(t.matchAll(new RegExp(d,"g"))).forEach(D=>{o.push([i,D.index,l.length])})})}return o}function te(e,t,{minlen:n=5,maxlen:r=16,minFind:a=.7,residualThreshold:o=5,ransacIterations:s=1e3,display:c=!1,yieldall:l=!1,strstep:i=1}){let d=ye(e,t,{minlen:n,maxlen:r,step:i});if(d.length<3)return c&&console.log("stralign fail, not enough matches found"),null;function p(f,T){return f>.5&&f<1.5}const[D,z,R,m]=Ve(d.map(f=>[f[0]]),d.map(f=>[f[1]]),o,s,p),b=d.filter((f,T)=>m[T]);let C=Array(e.length).fill(null);if(b.forEach(([f,T,v])=>{for(let I=0;I<v;I++)C[I+f]===null&&(C[I+f]=T+I)}),C.filter(f=>f!==null).length/C.length<a)return c&&console.log("stralign fail, not enough of string was found"),null;if(l){let f=t.split("");C.forEach(v=>{v!==null&&(f[v]="")});let T=te(e,f.join(""),n);return T?[C].concat(T):[C]}return[C]}function Ve(e,t,n,r=1e3,a=null){let o=[0,NaN,NaN,[]];for(let s=0;s<r;s++){let c=Math.floor(Math.random()*e.length),l=Math.floor(Math.random()*e.length);if(e[l][0]===e[c][0])continue;let i=(t[l][0]-t[c][0])/(e[l][0]-e[c][0]),d=t[c][0]-i*e[c][0];if(a&&!a(i,d))continue;let z=e.map(m=>i*m[0]+d).map((m,b)=>Math.abs(m-t[b][0])).map(m=>m<n),R=z.reduce((m,b)=>m+(b?1:0),0);(!o||o[0]<R)&&(o=[R,i,d,z])}return o}const ne=(e,t)=>t.some(n=>e instanceof n);let ge,pe;function Oe(){return ge||(ge=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function je(){return pe||(pe=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const oe=new WeakMap,$=new WeakMap,X=new WeakMap;function Re(e){const t=new Promise((n,r)=>{const a=()=>{e.removeEventListener("success",o),e.removeEventListener("error",s)},o=()=>{n(G(e.result)),a()},s=()=>{r(e.error),a()};e.addEventListener("success",o),e.addEventListener("error",s)});return X.set(t,e),t}function Fe(e){if(oe.has(e))return;const t=new Promise((n,r)=>{const a=()=>{e.removeEventListener("complete",o),e.removeEventListener("error",s),e.removeEventListener("abort",s)},o=()=>{n(),a()},s=()=>{r(e.error||new DOMException("AbortError","AbortError")),a()};e.addEventListener("complete",o),e.addEventListener("error",s),e.addEventListener("abort",s)});oe.set(e,t)}let re={get(e,t,n){if(e instanceof IDBTransaction){if(t==="done")return oe.get(e);if(t==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return G(e[t])},set(e,t,n){return e[t]=n,!0},has(e,t){return e instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in e}};function Ee(e){re=e(re)}function ze(e){return je().includes(e)?function(...t){return e.apply(se(this),t),G(this.request)}:function(...t){return G(e.apply(se(this),t))}}function We(e){return typeof e=="function"?ze(e):(e instanceof IDBTransaction&&Fe(e),ne(e,Oe())?new Proxy(e,re):e)}function G(e){if(e instanceof IDBRequest)return Re(e);if($.has(e))return $.get(e);const t=We(e);return t!==e&&($.set(e,t),X.set(t,e)),t}const se=e=>X.get(e);function qe(e,t,{blocked:n,upgrade:r,blocking:a,terminated:o}={}){const s=indexedDB.open(e,t),c=G(s);return r&&s.addEventListener("upgradeneeded",l=>{r(G(s.result),l.oldVersion,l.newVersion,G(s.transaction),l)}),n&&s.addEventListener("blocked",l=>n(l.oldVersion,l.newVersion,l)),c.then(l=>{o&&l.addEventListener("close",()=>o()),a&&l.addEventListener("versionchange",i=>a(i.oldVersion,i.newVersion,i))}).catch(()=>{}),c}const Ue=["get","getKey","getAll","getAllKeys","count"],Ke=["put","add","delete","clear"],ee=new Map;function me(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&typeof t=="string"))return;if(ee.get(t))return ee.get(t);const n=t.replace(/FromIndex$/,""),r=t!==n,a=Ke.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(a||Ue.includes(n)))return;const o=async function(s,...c){const l=this.transaction(s,a?"readwrite":"readonly");let i=l.store;return r&&(i=i.index(c.shift())),(await Promise.all([i[n](...c),a&&l.done]))[0]};return ee.set(t,o),o}Ee(e=>({...e,get:(t,n,r)=>me(t,n)||e.get(t,n,r),has:(t,n)=>!!me(t,n)||e.has(t,n)}));const He=["continue","continuePrimaryKey","advance"],we={},ie=new WeakMap,De=new WeakMap,Ge={get(e,t){if(!He.includes(t))return e[t];let n=we[t];return n||(n=we[t]=function(...r){ie.set(this,De.get(this)[t](...r))}),n}};async function*Ye(...e){let t=this;if(t instanceof IDBCursor||(t=await t.openCursor(...e)),!t)return;t=t;const n=new Proxy(t,Ge);for(De.set(n,t),X.set(n,se(t));t;)yield n,t=await(ie.get(n)||t.continue()),ie.delete(n)}function be(e,t){return t===Symbol.asyncIterator&&ne(e,[IDBIndex,IDBObjectStore,IDBCursor])||t==="iterate"&&ne(e,[IDBIndex,IDBObjectStore])}Ee(e=>({...e,get(t,n,r){return be(t,n)?Ye:e.get(t,n,r)},has(t,n){return be(t,n)||e.has(t,n)}}));window.db=null;Je();async function Je(){if(window.db)return window.db;const e=await qe("audioStore",1,{upgrade(t,n,r,a,o){t.createObjectStore("recordings",{autoIncrement:!0})},blocked(t,n,r){console.log("DB BLOCKED")},blocking(t,n,r){console.log("DB BLOCKING")},terminated(){console.log("DB TERMINATED")}});return navigator.storage.persist(),window.db=e,e}function Ie(e,t,n){const r=e.slice();return r[15]=t[n],r[17]=n,r}function Ce(e){let t,n="üìç";return{c(){t=_("div"),t.textContent=n,this.h()},l(r){t=B(r,"DIV",{id:!0,"data-svelte-h":!0}),U(t)!=="svelte-85pxi0"&&(t.textContent=n),this.h()},h(){P(t,"id","playhead")},m(r,a){H(r,t,a)},d(r){r&&M(t)}}}function ve(e){let t,n,r=e[15].pre.replace(`
`,"<p />")+"",a,o,s=e[15].text+"",c,l,i=e[3]==e[17]&&Ce();return{c(){t=_("span"),n=new Me(!1),a=fe(),i&&i.c(),o=_("span"),c=Ae(s),this.h()},l(d){t=B(d,"SPAN",{ts:!0});var p=F(t);n=Se(p,!1),a=fe(),i&&i.l(p),o=B(p,"SPAN",{});var D=F(o);c=Le(D,s),D.forEach(M),p.forEach(M),this.h()},h(){n.a=a,A(o,"dubmarker",e[15].dubmarker),P(t,"ts",l=e[15].ts),A(t,"fade",e[3]>e[17]),A(t,"found",e[15].found),A(t,"maybefound",e[15].maybefound)},m(d,p){H(d,t,p),n.m(r,t),E(t,a),i&&i.m(t,null),E(t,o),E(o,c)},p(d,p){p&1&&r!==(r=d[15].pre.replace(`
`,"<p />")+"")&&n.p(r),d[3]==d[17]?i||(i=Ce(),i.c(),i.m(t,o)):i&&(i.d(1),i=null),p&1&&s!==(s=d[15].text+"")&&Pe(c,s),p&1&&A(o,"dubmarker",d[15].dubmarker),p&1&&l!==(l=d[15].ts)&&P(t,"ts",l),p&8&&A(t,"fade",d[3]>d[17]),p&1&&A(t,"found",d[15].found),p&1&&A(t,"maybefound",d[15].maybefound)},d(d){d&&M(t),i&&i.d()}}}function Qe(e){let t,n='<a id="menubutton">üê∂üéôÔ∏è dubwoofer</a> <div id="rightbuttons"><a id="optionsbutton">‚öôÔ∏é</a> <a id="exportbutton">‚Üß</a></div> <center id="projname"><a id="projmenu">Project name <span id="projmenudoot">‚ñº</span></a></center>',r,a,o,s,c="‚á§",l,i,d="‚ñ∫",p,D,z="‚è∏",R,m,b="‚è∫",C,u,f="‚óºÔ∏é",T,v,I="‚á•",S,j,O,N,L,K,x,Y,V,w=he(e[0]),y=[];for(let h=0;h<w.length;h+=1)y[h]=ve(Ie(e,w,h));return{c(){t=_("div"),t.innerHTML=n,r=W(),a=_("div"),o=_("center"),s=_("button"),s.textContent=c,l=W(),i=_("button"),i.textContent=d,p=W(),D=_("button"),D.textContent=z,R=W(),m=_("button"),m.textContent=b,C=W(),u=_("button"),u.textContent=f,T=W(),v=_("button"),v.textContent=I,S=W(),j=_("center"),O=_("div"),N=_("div"),L=_("div"),K=W(),x=_("pre");for(let h=0;h<y.length;h+=1)y[h].c();this.h()},l(h){t=B(h,"DIV",{id:!0,"data-svelte-h":!0}),U(t)!=="svelte-1vqh3ll"&&(t.innerHTML=n),r=q(h),a=B(h,"DIV",{id:!0});var k=F(a);o=B(k,"CENTER",{});var g=F(o);s=B(g,"BUTTON",{id:!0,"data-svelte-h":!0}),U(s)!=="svelte-1mdbl0w"&&(s.textContent=c),l=q(g),i=B(g,"BUTTON",{id:!0,"data-svelte-h":!0}),U(i)!=="svelte-1bzeqhc"&&(i.textContent=d),p=q(g),D=B(g,"BUTTON",{id:!0,"data-svelte-h":!0}),U(D)!=="svelte-ctqsq5"&&(D.textContent=z),R=q(g),m=B(g,"BUTTON",{id:!0,"data-svelte-h":!0}),U(m)!=="svelte-1ux48pt"&&(m.textContent=b),C=q(g),u=B(g,"BUTTON",{id:!0,"data-svelte-h":!0}),U(u)!=="svelte-1sl3bku"&&(u.textContent=f),T=q(g),v=B(g,"BUTTON",{id:!0,"data-svelte-h":!0}),U(v)!=="svelte-1xqfw81"&&(v.textContent=I),g.forEach(M),S=q(k),j=B(k,"CENTER",{});var Q=F(j);O=B(Q,"DIV",{class:!0});var le=F(O);N=B(le,"DIV",{class:!0,style:!0});var ae=F(N);L=B(ae,"DIV",{class:!0}),F(L).forEach(M),ae.forEach(M),le.forEach(M),Q.forEach(M),k.forEach(M),K=q(h),x=B(h,"PRE",{id:!0});var ue=F(x);for(let Z=0;Z<y.length;Z+=1)y[Z].l(ue);ue.forEach(M),this.h()},h(){P(t,"id","menubar"),P(s,"id","prev"),P(i,"id","play"),A(i,"gone",e[2]),P(D,"id","pause"),A(D,"gone",!e[2]),P(m,"id","rec"),A(m,"gone",e[1]),P(u,"id","stop"),A(u,"gone",!e[1]),P(v,"id","next"),P(L,"class","vu-gradient"),P(N,"class","vu-level"),de(N,"width",e[4]+"%"),P(O,"class","vu-meter"),P(a,"id","controls"),P(x,"id","mainscript")},m(h,k){H(h,t,k),H(h,r,k),H(h,a,k),E(a,o),E(o,s),E(o,l),E(o,i),E(o,p),E(o,D),E(o,R),E(o,m),E(o,C),E(o,u),E(o,T),E(o,v),E(a,S),E(a,j),E(j,O),E(O,N),E(N,L),H(h,K,k),H(h,x,k);for(let g=0;g<y.length;g+=1)y[g]&&y[g].m(x,null);Y||(V=[J(s,"click",e[9]),J(i,"click",e[7]),J(D,"click",e[8]),J(m,"click",e[5]),J(u,"click",e[6]),J(v,"click",e[10])],Y=!0)},p(h,[k]){if(k&4&&A(i,"gone",h[2]),k&4&&A(D,"gone",!h[2]),k&2&&A(m,"gone",h[1]),k&2&&A(u,"gone",!h[1]),k&16&&de(N,"width",h[4]+"%"),k&9){w=he(h[0]);let g;for(g=0;g<w.length;g+=1){const Q=Ie(h,w,g);y[g]?y[g].p(Q,k):(y[g]=ve(Q),y[g].c(),y[g].m(x,null))}for(;g<y.length;g+=1)y[g].d(1);y.length=w.length}},i:ce,o:ce,d(h){h&&(M(t),M(r),M(a),M(K),M(x)),Te(y,h),Y=!1,ke(V)}}}function Xe(e,t,n){window.stralign=te,window.strpins=ye,window.original=`It was a day just like any other. I walked out of the bathroom, still a bit groggy, and walked to the kitchen. I switched on the light.
Click.
I squinted at the brightness, and as my eyes adjusted, a large figure came into focus sitting at the table.
"Who... who are you?" I asked, bewildered.
"You don't know me. But we need to talk."
We need to talk? That sounded ominous.
`;let{origText:r,origLocs:a,dispSegs:o}=Ne(original);window.origText=r,window.origLocs=a,window.dispSegs=o,window.segIndex=Array(r.length).fill(null);let s=0;o.forEach((u,f)=>{segIndex.splice(s,u.word.length,...Array(u.word.length).fill(f)),s+=u.word.length+1}),window.sr=new webkitSpeechRecognition,sr.continuous=!0,sr.interimResults=!0,sr.maxAlternatives=5,sr.onresult=m,sr.onspeechend=sr.onsoundend=sr.onend=u=>{console.log(`${u.timeStamp} end`),n(1,c=!1),sr.stop()};let c=!1,l=!1;function i(){n(1,c=!0),sr.start()}function d(){n(1,c=!1),sr.stop()}function p(){n(2,l=!0)}function D(){n(2,l=!1)}function z(){const u=o.slice(0,b).findLastIndex(f=>f.dubmarker);console.log(`Prev from ${b}: ${u}`),u>=0&&(console.log(`Backing up to ${u} ${o[u].word}`),n(3,b=u))}function R(){const u=o.slice(b+1).findIndex(f=>f.dubmarker);u>=0&&(n(3,b=u+b+1),console.log(`Advancing to ${b} ${o[b].word}`))}function m(u){let f=u.results[u.resultIndex],T=f.isFinal,v=0;o.forEach(I=>{I.foundInResultIndex===u.resultIndex&&(I.maybefound=!1)});for(let I=0;I<f.length;I++){let S=f[I].transcript.toLowerCase().replace(/[^a-z ]/g," ");f[I].confidence;let j=f[I].transcript.split(" ").pop();if(console.log(`${u.timeStamp} word: ${j}`),S.length<16&&!T)continue;let O=0;if(S.length<16&&u.resultIndex>0){let x=u.results[u.resultIndex-1][0].transcript.toLowerCase().replace(/[^a-z ]/g," ");S=x+S,O=x.length}let N=te(S,r,{});if(N===null){console.log(`Couldn't find match for ${S}, skipping`);continue}let L=null,K=null;if(N.forEach(x=>{let Y=x.reduce((w,y)=>y!=null?w+1:w,0),V=x.map(w=>w===null?null:segIndex[w]);Y>v&&(V.indexOf(b)>=0||V.indexOf(b-1)>=0)&&(L=x,K=S)}),L===null){console.log(`Couldn't find ${S} at highlight`);continue}L=L.slice(O),console.log(`Found ${K} at ${L}`),L.forEach((x,Y)=>{if(x===null)return;let V=segIndex[x];if(V===null)return;let w=o[V];T?w.found=!0:w.maybefound=!0,n(3,b=V+1),w.foundInResultIndex=u.resultIndex,(!w.ts||w.foundInResultIndex!=u.resultIndex)&&(w.ts=u.timeStamp),w.ts&&V>0&&o[V-1].ts&&w.ts-o[V-1].ts>700+50*o[V-1].word.length&&(w.dubmarker=!0)})}n(0,o=[...o])}let b=0,C=0;return window.audiostream=null,window.audioctx=null,navigator.mediaDevices.getUserMedia({audio:!0}).then(u=>{const f=new(window.AudioContext||window.webkitAudioContext);window.audioctx=f,window.audiostream=u;const T=f.createMediaStreamSource(u),v=f.createAnalyser();v.fftSize=2048,T.connect(v);const I=new Float32Array(v.fftSize);function S(){v.getFloatTimeDomainData(I);const j=Math.sqrt(I.reduce((N,L)=>N+L*L)/I.length),O=j<1e-60?-60:20*Math.log10(j);n(4,C=(O- -60)/60*100),(C<0||isNaN(C))&&n(4,C=0),C>100&&n(4,C=100),requestAnimationFrame(S)}S()}).catch(u=>{console.error("Microphone access denied:",u)}),[o,c,l,b,C,i,d,p,D,z,R]}class et extends _e{constructor(t){super(),Be(this,t,Xe,Qe,xe,{})}}export{et as component};
